document.addEventListener("DOMContentLoaded",()=>{asignarEventoNav(),cambiarSeccion("adornos"),ajustesFormulario(),permisoNotificacion()});let ubicacion="adornos",referenciaServicios=[],servicioAgregado=[];const contenedorCard=document.querySelector("#contenedorCard");contenedorCard.addEventListener("click",evaluarServicio);const contenedorCardResumen=document.querySelector("#contenedorCardResumen"),formulario=document.querySelector("#formulario");formulario.addEventListener("submit",revisarFormulario);const seccionResumen=document.querySelector("#seccionResumen"),rutaImgErrorApi="../../build/img/error-servicios.png",rutaImgErrorForm="../../build/img/error-formulario.jpg",links=document.querySelectorAll(".navegacion .nav-item");function permisoNotificacion(){"Notification"in window&&Notification.requestPermission()}function asignarEventoNav(){links.forEach(e=>{e.addEventListener("click",ubicacionNav)})}function ubicacionNav(e){links.forEach(e=>{e.classList.contains("active")&&e.classList.remove("active")}),e.target.classList.add("active"),ubicacion=e.target.dataset.id,cambiarSeccion(ubicacion)}function cambiarSeccion(e){document.querySelector("#tituloSeccion").textContent=e,"resumen"===e?mostrarResumen():consultarAPI(e)}async function consultarAPI(e){const o="http://localhost:3500/"+e;try{const e=await fetch(o),t=await e.json();referenciaServicios=t,pintarDatos(t)}catch(e){alertas("Ouch!!","Lo sentimos, algo pasa al consultar nuestros servicios. revise su conexión a internet o intentelo más tarde. Gracias",rutaImgErrorApi)}}function pintarDatos(e){limpiarContenido(),seccionResumen.classList.add("ocultar"),contenedorCard.classList.remove("ocultar");const o=document.createDocumentFragment(),t=document.querySelector("#templateCard").content;e.forEach(e=>{const{idServicio:r,nombre:i,piezas:n,precio:a,detalles:c}=e;t.querySelector("#cardTitulo").textContent=i,t.querySelector("#cardCantidad span").textContent=n,t.querySelector("#cardPrecio span").textContent=a,t.querySelector("#cardSeleccionar").dataset.id=r,t.querySelector("#cardDetalle span").textContent=c;const s=t.cloneNode(!0);o.appendChild(s)}),contenedorCard.appendChild(o)}function mostrarResumen(){return limpiarContenido(),prepararServiciosForm(),seccionResumen.classList.contains("ocultar")&&(seccionResumen.classList.remove("ocultar"),seccionResumen.classList.add("mostrar"),contenedorCard.classList.add("ocultar")),pintarResumen()}function pintarResumen(){const e=document.querySelector("#alertaResumen"),o=document.querySelector("#templateResumenCard").content,t=document.createDocumentFragment();if(limpiarResumen(),servicioAgregado.length<1)return formulario.classList.add("ocultar"),e.textContent=" Aún no ha seleccionado servicios...",void document;formulario.classList.remove("ocultar"),contenedorCardResumen.addEventListener("click",acciones),e.textContent="",servicioAgregado.forEach(e=>{const{idServicio:r,nombre:i,piezas:n,precio:a,detalles:c,totalPiezas:s,totalPrecio:l,cantidad:u}=e;o.querySelector("#resumenTitulo").textContent=i,o.querySelector("#resumenDetalle span").textContent=c,o.querySelector("#resumenPiezas span").textContent=n,o.querySelector("#resumenPrecio span").textContent=a,o.querySelector("#resumenCantidad span").textContent=u,o.querySelector("#resumenPiezasTotal span").textContent=s,o.querySelector("#resumenPrecioTotal span").textContent=l,o.querySelector("#sumarServicio").dataset.id=r,o.querySelector("#removerServicio").dataset.id=r;const d=o.cloneNode(!0);t.appendChild(d)}),contenedorCardResumen.appendChild(t)}function evaluarServicio(e){if("cardSeleccionar"!==e.target.id)return null;const o=referenciaServicios.filter(o=>o.idServicio===e.target.dataset.id).pop();comprobarExistencia(o)?actualizarSumarServicio(o):agregarServicioNuevo(o),notificacionMovimiento()}function comprobarExistencia(e){return!!servicioAgregado.some(o=>o.idServicio===e.idServicio)}function agregarServicioNuevo(e){return e.totalPrecio=e.precio,e.totalPiezas=e.piezas,servicioAgregado=[...servicioAgregado,e]}function actualizarSumarServicio(e){servicioAgregado.map(o=>(o.idServicio===e.idServicio&&(o.cantidad++,o.totalPrecio=o.precio*o.cantidad,o.totalPiezas=o.cantidad*o.piezas),o))}function actualizarRestarServicio(e){servicioAgregado.map(o=>{if(o.idServicio===e.idServicio)return o.cantidad--,o.totalPrecio=o.cantidad*o.precio,o.totalPiezas=o.cantidad*o.piezas,o}),servicioAgregado.forEach((o,t,r)=>{if(o.idServicio===e.idServicio&&o.cantidad<1)return servicioActualizado=r.filter(e=>0!==e.cantidad),servicioAgregado=servicioActualizado})}function notificacionMovimiento(){const e=document.querySelector("#resumen");if(servicioAgregado.length>0?e.classList.add("notificacion"):e.classList.remove("notificacion"),"granted"===Notification.permission){let e=new Notification("Has agregado un nuevo servicio. Ver resumen");setTimeout(e.close.bind(e),5e3)}}function acciones(e){let o=servicioAgregado.filter(o=>o.idServicio===e.target.dataset.id);return o=o.pop(),"sumarServicio"===e.target.id?(actualizarSumarServicio(o),prepararServiciosForm(),pintarResumen()):"removerServicio"===e.target.id?(actualizarRestarServicio(o),notificacionMovimiento(),prepararServiciosForm(),pintarResumen()):void 0}function limpiarContenido(){for(;contenedorCard.firstChild;)contenedorCard.removeChild(contenedorCard.firstChild)}function limpiarResumen(){for(;contenedorCardResumen.firstElementChild;)contenedorCardResumen.removeChild(contenedorCardResumen.firstChild)}function alertas(e,o,t){return Swal.fire({title:e,text:o,imageUrl:t,imageWidth:350,imageHeight:200,confirmButtonText:"Entendido"})}function ajustesFormulario(){const e=new Date;let o=e.getFullYear(),t=e.getMonth()+1,r=e.getDate();t=t<10?"0"+t:t,r=r<10?"0"+r:r;const i=`${o}-${t}-${r}`;document.querySelector("#fecha").setAttribute("min",i)}function revisarFormulario(e){e.preventDefault();const o=new FormData(formulario),t=Array.from(o.values()).every(e=>""!==e.trim());return t&&enviarDatos(o),t?/\S+@\S+\.\S+/.test(o.get("correo"))?void 0:alertas("Revisar correo","El correo no parece ser válido",rutaImgErrorForm):alertas("Revisar campos","Todos los campos son obligatorios",rutaImgErrorForm)}function prepararServiciosForm(){const e=JSON.stringify(servicioAgregado);document.querySelector("#selecciones").textContent=e}function enviarDatos(e){console.log(Array.from(e.entries())),alertas("AVISO","falta agregar ajax para enviar los datos f12 para ver el console log con los datos que se enviarían")}
/*! modernizr 3.6.0 (Custom Build) | MIT *
 * https://modernizr.com/download/?-webp-setclasses !*/!function(e,o,t){function r(e,o){return typeof e===o}function i(e){var o=d.className,t=l._config.classPrefix||"";if(A&&(o=o.baseVal),l._config.enableJSClass){var r=new RegExp("(^|\\s)"+t+"no-js(\\s|$)");o=o.replace(r,"$1"+t+"js$2")}l._config.enableClasses&&(o+=" "+t+e.join(" "+t),A?d.className.baseVal=o:d.className=o)}function n(e,o){if("object"==typeof e)for(var t in e)u(e,t)&&n(t,e[t]);else{var r=(e=e.toLowerCase()).split("."),a=l[r[0]];if(2==r.length&&(a=a[r[1]]),void 0!==a)return l;o="function"==typeof o?o():o,1==r.length?l[r[0]]=o:(!l[r[0]]||l[r[0]]instanceof Boolean||(l[r[0]]=new Boolean(l[r[0]])),l[r[0]][r[1]]=o),i([(o&&0!=o?"":"no-")+r.join("-")]),l._trigger(e,o)}return l}var a=[],c=[],s={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,o){var t=this;setTimeout((function(){o(t[e])}),0)},addTest:function(e,o,t){c.push({name:e,fn:o,options:t})},addAsyncTest:function(e){c.push({name:null,fn:e})}},l=function(){};l.prototype=s,l=new l;var u,d=o.documentElement,A="svg"===d.nodeName.toLowerCase();!function(){var e={}.hasOwnProperty;u=r(e,"undefined")||r(e.call,"undefined")?function(e,o){return o in e&&r(e.constructor.prototype[o],"undefined")}:function(o,t){return e.call(o,t)}}(),s._l={},s.on=function(e,o){this._l[e]||(this._l[e]=[]),this._l[e].push(o),l.hasOwnProperty(e)&&setTimeout((function(){l._trigger(e,l[e])}),0)},s._trigger=function(e,o){if(this._l[e]){var t=this._l[e];setTimeout((function(){var e;for(e=0;e<t.length;e++)(0,t[e])(o)}),0),delete this._l[e]}},l._q.push((function(){s.addTest=n})),l.addAsyncTest((function(){function e(e,o,t){function r(o){var r=!(!o||"load"!==o.type)&&1==i.width;n(e,"webp"===e&&r?new Boolean(r):r),t&&t(o)}var i=new Image;i.onerror=r,i.onload=r,i.src=o}var o=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],t=o.shift();e(t.name,t.uri,(function(t){if(t&&"load"===t.type)for(var r=0;r<o.length;r++)e(o[r].name,o[r].uri)}))})),function(){var e,o,t,i,n,s;for(var u in c)if(c.hasOwnProperty(u)){if(e=[],(o=c[u]).name&&(e.push(o.name.toLowerCase()),o.options&&o.options.aliases&&o.options.aliases.length))for(t=0;t<o.options.aliases.length;t++)e.push(o.options.aliases[t].toLowerCase());for(i=r(o.fn,"function")?o.fn():o.fn,n=0;n<e.length;n++)1===(s=e[n].split(".")).length?l[s[0]]=i:(!l[s[0]]||l[s[0]]instanceof Boolean||(l[s[0]]=new Boolean(l[s[0]])),l[s[0]][s[1]]=i),a.push((i?"":"no-")+s.join("-"))}}(),i(a),delete s.addTest,delete s.addAsyncTest;for(var m=0;m<l._q.length;m++)l._q[m]();e.Modernizr=l}(window,document);
//# sourceMappingURL=main.js.map
